## 上下文无关文法

> [!def] CFG
> $(V,\Sigma,R,S)$
> - $V$: 有穷变元集
> - $\Sigma$: 有穷终结符集
> - $R$: 有穷规则集，形如 $A\to w$的产生式
> - $S$: 起始变元

> [!def] 推导/派生
> $w\Rightarrow z$, iff $\exists u,v\in(V\cup\Sigma)^*,A\to x \in R$, s.t. $w=uAv,z=uxv$
> $w \stackrel*\Rightarrow z$, if $\exists w_{i}$ s.t. $w\Rightarrow w_{1}\Rightarrow w_{2}\Rightarrow \cdots\Rightarrow z$

> [!def] CFL
> 对于 CFG $G$：$L(G)=\{ w|w\in\Sigma^*,S\stackrel*\Rightarrow w \}$
> 对于语言 $L$，若存在 CFG $G$ 使得 $L=L(G)$

如果 $L(G_{1})=L(G_{2})$，称 $G_{1}$ 和 $G_{2}$ 等价
### 推导

> [!def] 推导树
> 从 $S$ 开始，每应用一个产生式 $A\to w_{1}w_{2}..w_{k}$ 就在 $A$ 节点下挂 $k$ 个子节点 $w_{i}$

^8b6069

> [!def] 最左推导
> 每次替换最左边的变元

^71d595

更形式化地：
- 给定 CFG $G = (V, \Sigma, R, S)$，
- 最左推导是一个推导序列
    $S \Rightarrow \alpha_1 \Rightarrow \alpha_2 \Rightarrow \cdots \Rightarrow \alpha_n = w$
    满足在每一步 $\alpha_i \Rightarrow \alpha_{i+1}$ 中，替换的是 $\alpha_i$ 中**最左边的非终结符**。

使用最左推导作为一组推导树的代表，两个推导树是本质不同的当且仅当最左推导不同

> [!def] 歧义
> 如果 $w$ 在 CFG $G$ 中有两个或以上的不同最左推导，则 $G$ 歧义地产生 $w$.
> 如果存在 $w$ 使得 $G$ 歧义地产生 $w$ 则 $G$ 是歧义的
> 如果语言 $L$ 不能由非歧义 CFG 生成，则它是固有歧义的

> [!example]
> $E\to E+E \mid E\times E\mid(E)\mid a\mid b\mid c$
> 此时 $a+b\times c$ 有两个不同的推导树
> ![[syntax-tree.png]]
> 修改成无歧义的：
> $E\to E+T\mid T$
> $T\to T\times F\mid F$
> $F\to(E)\mid a\mid b\mid c$
> 三级：Factor, Term, Expression

**如何设计一个CFG？**

1. 化简和分解
2. 递归，例如上面的三级表达式
3. 正则表达式：如果某一个部分是正则的，先用 DFA / NFA 表示出来，然后转换成 CFG
> [!example]
> ![[NFA.png]]
> 相应的 CFG:
> $S_{0}\to aS_{1}\mid bS_{1}$
> $S_{1}\to aS_{1}\mid bS_{1}\mid 0S_{1}\mid 1S_{1} \mid \varepsilon$

由上面这个例子的启示，我们可以定义正则文法
### 正则文法

> [!def] 正则文法
> 四元组 $(V,\Sigma,R,S)$，与上下文无关文法类似，但规则集 $R$ 是以下三种形式之一：
> - $A\to a$
> - $A\to aB$
> - $A\to\varepsilon$

这样产生的语言一定是正则语言（理解：可以构造对应的 NFA，一个变元对应一个状态，能产生 $\varepsilon$ 的变元是接受状态）

## 乔姆斯基范式

> [!def] 乔姆斯基范式
> 设 $G=(V,\Sigma,R,S)$ 是一个 CFG，它是乔姆斯基范式当它的规则都是下列之一的形式 $$ \begin{aligned} A&\to BC\\ A&\to a\\ S&\to \varepsilon \end{aligned} $$
> 其中 $a \in \Sigma; A \in V; B,C \in V \setminus \{ S \}$

> [!theorem]
> 任何一个 CFL 都可以用乔姆斯基范式的 CFG 生成

> [!proof]
> 将一个 CFG 转换为乔姆斯基范式：
> 1. 消除 $\varepsilon$ 规则 $A\to\varepsilon$
> 	- $A$ 只产生 $\varepsilon$，删除 $A\to\varepsilon$ 将产生式所有右边的 $A$ 换成 $\varepsilon$
> 	- 反之，删去 $A\to\varepsilon$ 后将原来在右边的一个或多个 $A$ 换成 $\varepsilon$ 后 **添加** 到规则集
> 2. 消除单一产生式 $A\to B$
> 	1. 对于所有的 $B\to u$ 产生式，在规则中添加 $A\to u$
> 	2. 删除 $A\to B$
> 3. 消除长产生式 $A\to u_{1}u_{2}\dots u_{k}(k> {2})$
> 	替换成产生式 $A\to u_{1}A_{1},A_{1}\to u_{2}A_{2},\dots,A_{k-2}\to u_{k-1}u_{k}$
> 4. 消除混合
> 	如果右边的长度是二，但不全是变元，那么对于每一个终结符 $u$ ，用变元 $U$ 替换 $u$，加入产生式 $U\to u$

> [!theorem]
> $G=(V,\Sigma,R,S)$ 是一个乔姆斯基范式，$w\in L(G),\mathcal{T}$ 是 $S\stackrel*\Rightarrow w$ 的一个推导树，$\mathcal{T}$ 深度为 $n$ 则 $\lvert w \rvert\leq 2^{n-1}$
> > [!def] 深度
> > 根节点到叶子的最大距离

^d55cee

> [!proof]
> 对深度归纳


## 泵引理

考虑一个 CFG 的 [[上下文无关语言#^8b6069|推导树]]，如果树中存在两个相同变元 $R$ 的节点 $R_{1}$和 $R_{2}$并且 $R_{2}$ 在 $R_{1}$ 的子树内，如果将多次用大的 $R_{1}$ 子树替换 $R_{2}$ 子树，产生出的字符串会越来越长

![[CFG-pumping-lemma.png]]

> [!theorem] CFL 泵引理
> 对于任意的 (无穷) 上下文无关语言 $L$, 存在正整数 $p$ (称为泵长度), 使得对于任意 $w \in L$，如果 $|w| ≥ p$, 则 $w$ 可被分成 5 段，即 $w = uvxyz$, 且
> 1. $|vy | \geq 1$；
> 2. $|vxy| \leq p$；
> 3. 对于任意 $n \geq 0$, $uv^nxy^nz \in L$

> [!proof]
> 使用 $L$ 的 [[上下文无关语言#乔姆斯基范式|乔姆斯基范式]] 文法 $G=(V,\Sigma,R,S)$
> 设 $n=\lvert V \rvert$，取 $p=2^n$
> 设 $w\in L,\lvert w \rvert\geq p,\mathcal{T}$ 是 $S\stackrel*\implies w$ 的推导树
> 由 [[上下文无关语言#^d55cee|推导树深度引理]] $\mathcal{T}$ 的深度 $\geq n+1$
> 设$p$是从 $T$ 的根结点到叶子结点之间距离最长的一条路径，则$p$上至少有 $n + 2$ 个结点 (包含根结点和叶子结点)，除叶子结点标的是终结符外，其余的结点标的都是变元，于是$p$上至少有 $n + 1$ 个变元结点。
> 我们选取p上最接近叶子的 $n + 1$ 个变元结点，根据鸽子笼原理，在它们之中至少有一个变元，设为 $R$, 出现了两次。存在 $u,v,x,y,z$，使得 $w=uvxyz,S\stackrel*\Rightarrow uRz,R\stackrel*\Rightarrow vRy,R\stackrel*\Rightarrow x$，所以对于任意 $n\geq {0}$ 有 $S\stackrel*\Rightarrow uv^nxy^nz$，第三条成立
> 由于是最接近叶子的 $n+1$ 个变元， $R$ 子树深度不超过 $n+1$，由前面引理知 $\lvert vxy \rvert\leq 2^n=p$，第二条成立
> 根据乔姆斯基范式特点，$R\stackrel*\Rightarrow vRy$ 的第一步只能用 $R\to BC$，而 BC不是起始变元，推不出 $\varepsilon$，产生的子树中不可能只有另一个 $R$ ，所以 $\lvert vy \rvert\geq {1}$，第一条满足

> [!example]
> $B=\{ a^nb^nc^n \}$ 不是 CFL

> [!proof]
> 对任意正整数 $p$，设串 $s=a^p b^p c^p$，若满足泵引理前两个条件，则
> 1. v , x, y 全由一个字母组成，这时只能泵出 a, b, c 中的一个字符，另外两个不能泵出，泵出的结果不在 B 中。
> 2. v , x, y 全由 a, b 组成，这时最多只能泵出 a, b 两个字符 (至少能泵一个)，c 不能泵出，泵出的结果也不在 B 中。
> 3. v , x, y 全由 b, c 组成，类似于情况 2，泵出的结果也不在 B中。
> 与泵引理冲突，故 B 不是 CFL。

## CFL 的封闭性

> [!theorem] CFL 的封闭性
> CFL 关于并、连接、星运算封闭

> [!proof]
> 对于 $G_{1}=(V_{1},\Sigma_{1},R_{1},S_1)$ 和 $G_{2}=(V_{2},\Sigma_{2},R_{2},S_{2})$
> - 并：$G_{3}=(V_{1} \cup V_{2} \cup \{ S \},\Sigma_{1}\cup\Sigma_{2},R_{1}\cup R_{2}\cup \{ S\to S_{1}|S_{2} \},S)$
> - 连接：$G_{4}=(V_{1} \cup V_{2} \cup \{ S \},\Sigma_{1}\cup\Sigma_{2},R_{1}\cup R_{2}\cup \{ S\to S_{1}S_{2} \},S)$
> - 星：$G_{5}=(V_{1}\cup \{ S \},\Sigma_{1},R_{1}\cup \{ S\to S_{1}S\mid\varepsilon \},S)$

> [!theorem]
> CFL 关于交、补运算不封闭

> [!proof]
> - $A=\{ a^mb^nc^n\mid m,n\geq {0} \}$ 和 $B=\{ a^n b^n c^m\mid m,n\geq 0 \}$都是上下文无关语言，但 $A\cap B=\{ a^nb^nc^n \}$ 不是 CFL，所以关于交不封闭
> - 若关于补封闭，那么对于 CFL $C,D$而言，$\overline{\overline{C} \cup \overline{D}}=C\cap D$ 也是 CFL，矛盾

