## Basics

概率模型：将任务建模为计算变量的概率分布

- 生成：$P(Y,R,O)$
- 判别：$P(Y,R \mid O)$, $O$: Observable,可观测; $Y$: 关心的变量，$R$: Rest, 其他变量

概率图模型：

节点：随机变量（集合）
边：变量之间的依赖关系

## 有向图模型

### 隐马尔可夫 HMM

$y_{i}$: 状态；$x_{i}$: 观测

```
y1 -> y2 -> y3 -> ...
|     |     |
v     v     v
x1    x2    x3
```

> [!question] 
> 为什么是 _隐_ 马尔可夫模型?

因为观测变量 $x_{i}$ 不一定满足马尔可夫性，而是存在一个隐状态变量 $y_{i}$ 满足。

$t$ 时刻状态 $y_{t}$ 只依赖于 $y_{t-1}$

$$
P(x_{1},y_{1},\dots,x_{n},y_{n})=P(y_{1})P(x_{1}|y_{1})\prod_{i=2}^{n}P(y_{i}|y_{i-1})P(x_{i}|y_{i})
$$

参数化：$\lambda=[A,B,\pi]$

- 状态转移概率 $A=[a_{ij}]_{N\times N}, \quad a_{ij}=p(y_{t+1}=s_{j}|y_{t}=s_{i})$
- 输出观测概率 $B=[b_{ij}]_{N\times M}$
- 初始状态概率 $\pi=[\pi_{1},\dots \pi_{N}], \quad \pi_{i}=P(y_{1}=s_{i})$


参数学习：调整模型参数使得训练序列集 $\mathbf{X}=[\mathbf{x}^{(1)},\mathbf{x}^{(2)},\dots]$ 出现概率最大


## 无向图模型

### 马尔可夫随机场 MRF

> [!question]
> 为什么叫场？

图中每个位置都有一个随机变量，类似场中每一个位置都有一个量。e.g. 温度场中每个点都有一个温度

#### 分布形式化：

**使用基于极大团的势函数**
  
> [!def] maximal clique 极大团
> 如果一个团再加入任意点都不再成团，那么这个团是 _极大团_

先团分解，每一个节点都会在一个极大团里面（可能在多个极大团里面），然后在极大团上定义势函数 （因子）
对于 $n$ 个随机变量 $\mathbf{x}=\{ x_{1},x_{2},\dots,x_{n} \}$，定义 联合概率分布
$$P(\mathbf{x})=\dfrac{1}{Z^{*}}\prod_{Q\in \mathcal{C}^{*}}\psi_{Q}(\mathbf{x}_{Q})$$
其中 $\mathcal{C}$ 是极大团集合， $\psi_{Q}$ 是一个极大团 $Q$ 的 _势函数_（对于不同的团不是同一个函数！），$Z^{*}$ 是概率归一化系数

势函数非负，通常用指数函数定义，
$$\psi_{Q}(x_{Q})=e^{-H_{Q}(x_{Q})}$$

能量函数的常见形式：

$$H_{Q}(x_{Q})=\sum_{u,v\in Q,u\neq v}\alpha_{uv}x_{u}x_{v}+\sum_{v\in Q}\beta_{v}x_{v}$$

#### 条件独立性

如果节点集 $A$ 到节点集 $B$ 必须经过节点集 $C$，那么 $C$ 是 _分离集_

> [!theorem] 全局马尔可夫性
> 以分离集为条件，两个变量子集条件独立，记作 $x_{A}\perp x_{B}\mid x_{C}$

> [!proof]
> 证明一个简单的情况：
> ```
> [x_A] ---- [x_C] ---- [x_B]
> ```
> 三个节点
> 形式化地，需要证明的是 $P(x_{A},x_{B}\mid x_{C})=P(x_{A}\mid x_{C})P(x_{B}\mid x_{C})$
> 展开联合分布，用贝叶斯公式可以证明

一些特例：

> [!theorem] 局部马尔可夫性
> 给定 $v$ 的邻接变量 $n(v)$ 时，该变量与其他所有变量条件独立

> [!theorem] 成对马尔可夫性
> 给定其他所有变量时，两个非邻接变量条件独立


### 条件随机场

给定变量的观测序列 $\{ x_{1},x_{2},\dots,x_{n} \}$，预测标记序列 $\{ y_{1},y_{2},\dots,y_n \}$

 -  链式条件随机场 CRF 

$$
P(\mathbf{y}|\mathbf{x})=\dfrac{1}{Z} \exp\left( \sum_{i=1}^{n-1}t(y_{i},y_{i+1};\mathbf{x},i)+\sum_{i=1}^{n}s(y_{i};\mathbf{x},i) \right)
$$

### 模型推断

精确推断：变量消去

$$
\sum_{i}P(X_{j}|X_{i})P(X_{i})\coloneqq m_{ij}(X_{j})\quad \in \{ f:R^{n}\to R \}
$$

![[Pasted image 20260109113706.png]]

信念传播：通过 $m_{ij}$ 从 $i$ 向 $j$ 传递消息，然后收到所有入边节点的消息后向出边节点传递

### 话题模型

LDA: (Latent Dirichlet Allocation)


