
## 栈的特性(x86-linux-32)：
- 自顶向下生长
- 栈底地址是`0xbffffxxx`
- 栈单元：4 byte
![[Pasted image 20250417230320.png]
![[Pasted image 20250417230320.png]]
![[Pasted image 20250417230354.png]]
## 过程调用指令

- `CALL dest`: 下一条指令地址压栈，跳转到dest
- `RET`:返回（eip <= pop()）
- `RET n`：先退栈 $n$ 字节，然后返回
- `PUSH/POP`：略
- `LEAVE`：释放栈帧

| Instruction | Effective op                      |
| ----------- | --------------------------------- |
| `call addr` | `pushl %eip; jmp addr`            |
| `ret`       | `pop %eip`                        |
| `ret n`     | `pop %eip; subl n, %exp`          |
| `pushl src` | `subl $4, %esp; movl src, (%esp)` |
| `popl dest` | `movl (%esp) dest; addl $4, %esp` |
| `leave`     | `movl %ebp, %esp; popl %ebp`      |
由于函数调用时修改esp，故跨函数调用时不能使用`push/pop`传参，正确方法：栈指针+偏移

执行 `pushl %ebp; mov %esp, %ebp`之后：
```
[高地址]
参数 N
...
参数 2
参数 1          <-- 8(%ebp)
返回地址        <-- 4(%ebp)
保存的旧 %ebp   <-- 0(%ebp) 或 (%ebp)
局部变量        <-- -4(%ebp), -8(%ebp), 等
[低地址]
```

## C functions calls

## .CFI


## ABI

