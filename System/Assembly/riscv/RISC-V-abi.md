å¤ªå¥½äº†ï¼Œä½ æœ‰ x86 æ±‡ç¼–åŸºç¡€ï¼Œé‚£æˆ‘å°±ç”¨ **å’Œ x86 å¯¹æ¯”çš„æ–¹å¼**å¸®ä½ å¿«é€Ÿå»ºç«‹ RISC-V æ±‡ç¼–çš„æ•´ä½“æ¡†æ¶ã€‚

---

## 1. RISC-V åŸºæœ¬æŒ‡ä»¤é›†ï¼ˆRV32I/RV64Iï¼‰

å’Œ x86 ç›¸æ¯”ï¼ŒRISC-V æ˜¯ **çº¯ RISC**ï¼ŒæŒ‡ä»¤æ›´è§„åˆ™ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯â€œload/store æ¶æ„â€ï¼š

- **ç®—æœ¯é€»è¾‘è¿ç®—**ï¼šåªèƒ½å¯„å­˜å™¨é—´æ“ä½œï¼ˆç«‹å³æ•°é™¤å¤–ï¼‰ï¼Œä¸æ”¯æŒ `add eax, [mem]` è¿™ç§ x86 é£æ ¼ã€‚
    
- **è®¿å­˜æŒ‡ä»¤**ï¼šåªæœ‰ `lw/sw`ã€`lb/sb`ã€`lh/sh` ç­‰ï¼Œå¿…é¡»å…ˆåŠ è½½åˆ°å¯„å­˜å™¨ï¼Œå†ç®—ã€‚
    

### å¸¸ç”¨æŒ‡ä»¤ç±»åˆ«

1. **ç®—æœ¯/é€»è¾‘**
    
    ```
    add  rd, rs1, rs2    # rd = rs1 + rs2
    sub  rd, rs1, rs2
    and  rd, rs1, rs2
    or   rd, rs1, rs2
    xor  rd, rs1, rs2
    sll  rd, rs1, rs2    # shift left logical
    srl  rd, rs1, rs2    # shift right logical
    sra  rd, rs1, rs2    # shift right arithmetic
    slt  rd, rs1, rs2    # rd = (rs1 < rs2) ? 1 : 0
    ```
    
    å¸¦ç«‹å³æ•°ç‰ˆæœ¬ï¼ˆå¯¹åº” x86 çš„ `add eax, imm`ï¼‰ï¼š
    
    ```
    addi  rd, rs1, imm
    andi  rd, rs1, imm
    ori   rd, rs1, imm
    ```
    
2. **è®¿å­˜**ï¼ˆload/storeï¼‰
    
    ```
    lw   rd, offset(rs1)   # rd = *(int32*)(rs1 + offset)
    lh   rd, offset(rs1)
    lb   rd, offset(rs1)
    sw   rs2, offset(rs1)  # *(int32*)(rs1 + offset) = rs2
    ```
    
    - x86 å¯ä»¥ `mov eax, [ebx+8]`ï¼Œ  
        RISC-V å¿…é¡»å†™æˆï¼š
        
        ```asm
        lw  a0, 8(a1)   # load word
        ```
        
3. **è·³è½¬/åˆ†æ”¯**
    
    ```
    beq   rs1, rs2, label   # if (rs1 == rs2) goto label
    bne   rs1, rs2, label
    blt   rs1, rs2, label
    bge   rs1, rs2, label
    j     label             # æ— æ¡ä»¶è·³è½¬ (ä¼ªæŒ‡ä»¤ jal x0, label)
    jal   rd, label         # rd = PC+4; PC = label
    jalr  rd, offset(rs1)   # rd = PC+4; PC = rs1+offset
    ```
    
    ç›¸å½“äº x86 çš„ `jmp`, `call`, `ret`, `cmp+jxx`ã€‚
    
4. **ç‰¹æ®Š**
    
    ```
    lui   rd, imm20     # è£…è½½é«˜ 20 ä½
    auipc rd, imm20     # PC-relative åœ°å€é«˜ä½
    ecall               # ç³»ç»Ÿè°ƒç”¨
    ret                 # ä¼ªæŒ‡ä»¤ (jalr x0, 0(ra))
    nop                 # addi x0, x0, 0
    ```
    

---

## 2. RISC-V å¯„å­˜å™¨çº¦å®šï¼ˆABIï¼‰

RISC-V æœ‰ **32 ä¸ªé€šç”¨å¯„å­˜å™¨**ï¼Œ64 ä½æ¶æ„æ¯ä¸ªå¯„å­˜å™¨éƒ½æ˜¯ 64 ä½ï¼ˆRV64ï¼‰ã€‚  
ABI ç»™å®ƒä»¬å–äº†åˆ«åï¼Œå’Œè°ƒç”¨çº¦å®šå¯¹åº”ï¼š

|å¯„å­˜å™¨|ABI å|ç”¨é€”|ä¿å­˜çº¦å®š|
|---|---|---|---|
|x0|zero|å¸¸é‡ 0|å›ºå®šä¸º 0|
|x1|ra|return address|è°ƒç”¨è€…ä¿å­˜|
|x2|sp|stack pointer|è¢«è°ƒç”¨è€…ä¿å­˜|
|x3|gp|global pointer|å›ºå®š|
|x4|tp|thread pointer|å›ºå®š|
|x5â€“x7|t0â€“t2|ä¸´æ—¶å¯„å­˜å™¨|è°ƒç”¨è€…ä¿å­˜|
|x8|s0/fp|ä¿å­˜å¯„å­˜å™¨/å¸§æŒ‡é’ˆ|è¢«è°ƒç”¨è€…ä¿å­˜|
|x9|s1|ä¿å­˜å¯„å­˜å™¨|è¢«è°ƒç”¨è€…ä¿å­˜|
|x10â€“x17|a0â€“a7|å‡½æ•°å‚æ•° / è¿”å›å€¼|è°ƒç”¨è€…ä¿å­˜|
|x18â€“x27|s2â€“s11|ä¿å­˜å¯„å­˜å™¨|è¢«è°ƒç”¨è€…ä¿å­˜|
|x28â€“x31|t3â€“t6|ä¸´æ—¶å¯„å­˜å™¨|è°ƒç”¨è€…ä¿å­˜|

---

### è§„åˆ™æ€»ç»“ï¼ˆå’Œ x86 å¯¹æ¯”ï¼‰

- **è°ƒç”¨è€…ä¿å­˜ (caller-saved)**
    
    - `a0â€“a7`ï¼ˆå‡½æ•°å‚æ•°/è¿”å›å€¼ï¼‰
        
    - `t0â€“t6`ï¼ˆä¸´æ—¶å¯„å­˜å™¨ï¼‰
        
    - `ra`ï¼ˆè¿”å›åœ°å€ï¼‰  
        ğŸ‘‰ è°ƒç”¨å‡½æ•°å‰è¦è‡ªå·±ä¿å­˜ï¼Œå¦åˆ™ä¼šè¢«è¦†ç›–ã€‚  
        ï¼ˆx86 é‡Œç±»ä¼¼ `eax`, `ecx`, `edx`ï¼‰
        
- **è¢«è°ƒç”¨è€…ä¿å­˜ (callee-saved)**
    
    - `s0â€“s11`
        
    - `sp`  
        ğŸ‘‰ è¢«è°ƒå‡½æ•°å¿…é¡»åœ¨ç”¨ä¹‹å‰ `push`ï¼Œç»“æŸå‰æ¢å¤ã€‚  
        ï¼ˆx86 é‡Œç±»ä¼¼ `ebx`, `esi`, `edi`, `ebp`ï¼‰
        
- **ä¸´æ—¶å˜é‡**
    
    - `t0â€“t6` æœ€é€‚åˆå½“ scratch registersï¼Œç”¨å®Œä¸ç®¡ã€‚
        
- **å‚æ•°/è¿”å›å€¼**
    
    - å‰ 8 ä¸ªå‚æ•°æ”¾åœ¨ `a0â€“a7`
        
    - è¿”å›å€¼æœ€å¤š 2 ä¸ªï¼ˆ`a0`, `a1`ï¼‰ã€‚  
        ï¼ˆå¤šä½™å‚æ•°æ”¾æ ˆä¸Šï¼‰
        

---

### å¯¹æ¯”ä¸€ä¸‹è°ƒç”¨çº¦å®š

åœ¨ x86 System V ABIï¼š

- `rdi, rsi, rdx, rcx, r8, r9` â†’ å‚æ•°å¯„å­˜å™¨
    
- `rax, rdx` â†’ è¿”å›å€¼
    
- caller-savedï¼š`rax, rcx, rdx, rsi, rdi, r8â€“r11`
    
- callee-savedï¼š`rbx, rbp, r12â€“r15`
    

åœ¨ RISC-Vï¼š

- `a0â€“a7` â†’ å‚æ•°/è¿”å›å€¼
    
- caller-savedï¼š`a0â€“a7, t0â€“t6, ra`
    
- callee-savedï¼š`s0â€“s11, sp`
    

---

âœ… æ€»ç»“ï¼š

- RISC-V æŒ‡ä»¤éå¸¸è§„æ•´ï¼Œå‡ ä¹æ²¡æœ‰å¤æ‚å¯»å€æ¨¡å¼ã€‚
    
- å‡½æ•°è°ƒç”¨çº¦å®šç±»ä¼¼ x86 System Vï¼Œåªæ˜¯å¯„å­˜å™¨åå­—å’Œåˆ†ç»„ä¸åŒã€‚
    
- ä¸€å¥è¯è®°ä½ï¼š
    
    - **a å¯„å­˜å™¨** â†’ å‚æ•°argså’Œè¿”å›å€¼
        
    - **t å¯„å­˜å™¨** â†’ ä¸´æ—¶ temporary
        
    - **s å¯„å­˜å™¨** â†’ å¿…é¡»ä¿å­˜saveçš„å¯„å­˜å™¨ï¼ˆcallee-savedï¼‰
        

