
---

几类**指令系统**：

堆栈型(零地址指令)：所有操作数都在栈顶，不需要指定操作数，直接将结果压回栈顶

下面是 $C=A+B$ 的例子，$A$,$B$,$C$均为内存地址
```
PUSH A
PUSH B
ADD
POP C
```

累加器型(单地址指令)：包含一个隐含操作数：累加器，另一个操作数指令中指定，放回累加器中
```
LOAD  A
ADD   B
STORE C
```

寄存器-存储器型：操作数由指令显式指定，操作数是寄存器和内存单元
```
LOAD  R1, A
ADD   R1, B
STORE C, R1
```

寄存器-寄存器型：在这种类型的指令系统中，每个操作数由指令显式指定，除了访存指令外其他指令操作数都只能是寄存器。
```
LOAD R1, A
LOAD R2, B
ADD R3, R1, R2
STORE C, R3
```

---

**段页内存管理系统**

![[mem_system.png]]

页式管理：直接拼接页号和页内偏移

---

## 附录

**原子指令**：

例如：MIPS中的 ll / sc

MIPS 里的 **`ll` (Load Linked)** 和 **`sc` (Store Conditional)** 是一对配合使用的指令，用来在不需要复杂锁机制的情况下实现原子操作。它们背后的原理是 **硬件维护一段“保留区”(reservation)**，通过检测这段保留区是否被其他处理器或设备修改，来保证原子性。

### 🔹 指令语义

#### `ll rt, offset(base)`

- 含义：从 `base+offset` 地址加载一个字到寄存器 `rt`，**并在硬件里记录（reserve）这个地址**。
    
- 通常是缓存行粒度的保留区，而不仅仅是单个字。
    

#### `sc rt, offset(base)`

- 含义：如果自从上次 `ll` 之后，这个地址所在的保留区**没有被修改过**，那么：
    
    - 把 `rt` 的值存到内存（store 成功）
        
    - 并把 `rt` 置为 **1** 表示成功
        
- 否则（保留被破坏，比如别的 CPU/核写入过这个地址所在的缓存行）：
    
    - 不进行存储
        
    - 把 `rt` 置为 **0** 表示失败
        

### 🔹 硬件实现机制

1. **Load Linked**：
    
    - CPU 发出 `ll` 时，在 cache 或专门的 _reservation register_ 里标记一个地址范围（通常是一个 cache line，例如 32 或 64 字节）。
        
    - 并把值读出来返回给寄存器。
        
2. **Store Conditional**：
    
    - CPU 执行 `sc` 时，硬件检查 reservation 是否仍然有效：
        
        - 地址匹配
            
        - 中途没有被其他核/设备写过
            
    - 如果有效：执行写操作，返回成功标志。
        
    - 如果无效：不写，返回失败标志。
        
3. **失效条件（reservation cleared）**：
    
    - 其他处理器/核写入了这条 cache line（cache coherence 协议会通知）。
        
    - 当前 CPU 自己写入了该地址。
        
    - 有时中断/异常也会清除 reservation。
        

### 🔹 使用方法

典型用法：**原子 compare-and-swap / 原子加一**

```mips
# 原子加一示例
loop:
    ll   t0, 0(a0)       # t0 = *a0, 并建立reservation
    addi t0, t0, 1       # t0 = t0 + 1
    sc   t0, 0(a0)       # 尝试写回
    beq  t0, zero, loop  # 如果失败（t0=0），重试
```


### 🔹 特点

- **优点**：不需要总线锁，效率比“锁总线”方式高；能在多处理器环境下实现无锁原子操作。
    
- **缺点**：编程复杂，需要循环重试；失败概率随并发度上升。
    

✅ 总结  
`ll` + `sc` = _reservation based atomicity_：

- `ll` 读并标记地址
    
- `sc` 检查是否仍然“独占” → 成功就写，失败就返回 0  
    这对组合就能实现原子读-改-写操作。
    
